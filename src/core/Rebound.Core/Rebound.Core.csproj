<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net10.0-windows10.0.26100.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<Import Project="..\..\..\var\Version.props" />

	<UsingTask TaskName="GenerateVariablesFile" TaskFactory="CodeTaskFactory" AssemblyName="Microsoft.Build.Tasks.Core">
		<ParameterGroup>
			<OutputFile ParameterType="System.String" Required="true" />
			<VersionString ParameterType="System.String" Required="true" />
		</ParameterGroup>
		<Task>
			<Using Namespace="System.IO" />
			<Code Type="Fragment" Language="cs">
				<![CDATA[
        string content = string.Format(@"// Copyright (C) Ivirius(TM) Community 2020 - 2025. All Rights Reserved.
// Licensed under the MIT License.

namespace Rebound.Core;

/// <summary>
/// Contains variables that are used everywhere in Rebound: paths, versions, etc.
/// </summary>
public static partial class Variables
{{
    /// <summary>
    /// Represents the current version identifier for Rebound as a whole.
    /// </summary>
    public static string ReboundVersion = ""{0}"";
}}", VersionString);

        Directory.CreateDirectory(Path.GetDirectoryName(OutputFile));
        File.Delete(OutputFile);
        File.WriteAllText(OutputFile, content);
        return true;
      ]]>
			</Code>
		</Task>
	</UsingTask>

	<Target Name="GenerateVariablesCs" BeforeTargets="BeforeBuild;CoreCompile">
		<PropertyGroup>
			<VariablesGenerated>$(IntermediateOutputPath)Generated\Variables.cs</VariablesGenerated>
		</PropertyGroup>

		<Message Importance="high" Text="Generated file path: $(VariablesGenerated)" />
		<Message Importance="high" Text="New version: $(DisplayVersion)" />

		<GenerateVariablesFile OutputFile="$(VariablesGenerated)" VersionString="$(DisplayVersion)" />
		<ItemGroup>
			<Compile Remove="src/core/Rebound.Core/Variables.cs" />
			<Compile Include="$(VariablesGenerated)" />
		</ItemGroup>
	</Target>

</Project>
